services:
  gdrive-sync:
    build: .
    container_name: gdrive-sync
    restart: unless-stopped
    user: "${PUID:-1000}:${PGID:-1000}"
    entrypoint: /scripts/entrypoint.sh
    environment:
      - TZ=${TZ:-UTC}
      - SYNC_INTERVAL=${SYNC_INTERVAL:-5}
      - GMAIL_USER=${GMAIL_USER}
      - GMAIL_APP_PASSWORD=${GMAIL_APP_PASSWORD}
      - NOTIFY_EMAIL=${NOTIFY_EMAIL}
      - XDG_CACHE_HOME=/cache
    volumes:
      # rclone config (contains OAuth tokens, needs write access for token refresh)
      - ./config/rclone.conf:/config/rclone/rclone.conf
      # Exclude patterns
      - ./config/excludes.txt:/config/excludes.txt:ro
      # Scripts
      - ./scripts/entrypoint.sh:/scripts/entrypoint.sh:ro
      - ./scripts/sync.sh:/scripts/sync.sh:ro
      # Google Drive sync folder (host path from LOCAL_PATH)
      - ${LOCAL_PATH}:/data
      # Persistent bisync state (tracks file changes between runs)
      - ./data/bisync:/cache/rclone/bisync
